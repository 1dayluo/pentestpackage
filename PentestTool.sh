#!/bin/bash
# ------------------------------------------------------------------
# [Leon Teale] pentesttool.sh
#          Pentest and Reporting Tool
# ------------------------------------------------------------------
# Available soon:
# 	Burp reporter
#   Nikto reporter
#	Netbios Spoofing
#   
#


## Setting Coloured variables
red=`echo -e "\033[31m"`
lcyan=`echo -e "\033[36m"`
yellow=`echo -e "\033[33m"`
green=`echo -e "\033[32m"`
blue=`echo -e "\033[34m"`
purple=`echo -e "\033[35m"`
normal=`echo -e "\033[m"`


VERSION=2.0
SUBJECT=pentesttool31337
SETTINGS=$0_settings 
Title="Pentest Tool"

nessus_summary="/root/Desktop/Tools/ITG/Pen-Test-Tools/NessusParserSummary.py"
nessus_breakdown="/root/Desktop/Tools/ITG/Pen-Test-Tools/NessusParserBreakdown.py"
nmap_parser="/root/Desktop/Tools/ITG/Pen-Test-Tools/NmapParser.py"
nmap_portcount="/root/Desktop/Tools/ITG/Pen-Test-Tools/NmapPortCount.py"
whois_parser="/root/Desktop/Tools/ITG/Pen-Test-Tools/whoisbyip.sh"

nessus_file=""
openvas_file=""
whois_file=""
nmap_file=""
burp_file=""
nikto_file=""
whois_file=""
nmap_scope=""
not_completed="$red✘$normal"
completed="$green✔$normal"

 
# --- Options processing -------------------------------------------

status_nmap_full_tcp=$(if test -f "nmap-tcp-full.nmap"; then echo "$completed" ; else echo "$not_completed";fi)
status_nmap_quick_tcp=$(if test -f "nmap-quick-tcp-scan.nmap"; then echo "$completed" ; else echo "$not_completed";fi)
status_nmap_top_udp=$(if test -f "nmap-top-udp-scan.nmap"; then echo "$completed" ; else echo "$not_completed";fi)
status_nmap_developer=$(if test -f "nmap-developer-scan.nmap"; then echo "$completed" ; else echo "$not_completed";fi)
status_nmap_all=$(if [[ -f nmap-developer-scan.nmap && -f nmap-tcp-full.nmap && -f nmap-quick-tcp-scan.nmap && -f nmap-top-udp-scan.nmap ]]; then echo "$completed" ; else echo "$not_completed";fi)
status_nikto=$(if test -f "nikto_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)
status_wpscan=$(if test -f "wpscan_output.txt"; then echo "$completed" ; else echo "$not_completed";fi)
status_whois=$(if test -f "whois_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)

status_nessus=$(if test -f "nessus_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)
status_openvas=$(if test -f "nmap_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)


status_reporting_nessus_summary=$(if test -f "newfile.csv"; then echo "$completed" ; else echo "$not_completed";fi)
status_reporting_nessus_breakdown=$(if test -f "output.txt"; then echo "$completed" ; else echo "$not_completed";fi)
status_reporting_nmap_parser=$(if test -f ""; then echo "$completed" ; else echo "$not_completed";fi)
status_reporting_nmap_port_count=$(if test -f "data_nmap.csv"; then echo "$completed" ; else echo "$not_completed";fi)
status_reporting_whois_parser=$(if test -f "whois_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)

status_reporting_burp_parser=$(if test -f "nmap_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)
status_reporting_nikto_parser=$(if test -f "nmap_output.csv"; then echo "$completed" ; else echo "$not_completed";fi)



# --- Locks -------------------------------------------------------
LOCK_FILE=/tmp/$SUBJECT.lock
if [ -f "$LOCK_FILE" ]; then
   echo "Script is already running"
   exit
fi

trap "rm -f $LOCK_FILE" EXIT
touch $LOCK_FILE

#---- Body ---------------------------------------------------------

while true
	do
		clear
		echo "---------------------------------"
		echo "$yellow $Title v$VERSION$normal"
		echo "---------------------------------"
		echo -n -e " Current Working Dir: "
		pwd
		echo "---------------------------------"
		echo " 1) Testing"
		echo " 2) Reporting"
		echo ""
		echo " 0) exit"
		echo "---------------------------------"

		read Tool_opt
		case $Tool_opt in

			1)  ###### Start Testing Tool ############

				while true
					do
						clear
						echo "---------------------------------"
						echo "$yellow $Title v$VERSION$normal - Testing"
						echo "---------------------------------"
						echo -n -e " Current Working Dir: "
						pwd
						echo "---------------------------------"
						echo " 1) Nmap Scan        [$status_nmap_all]"
						echo " 2) Nikto Scan       [$status_nikto]"
						echo " 3) WPScan           [$status_wpscan]"
						echo " 4) Whois Scan       [$status_whois]"
						echo ""
						echo "------ Work in progress ---------"
						echo ""
						echo " 5) Nessus Scan      [$status_nessus]"
						echo " 6) Openvas Scan     [$status_openvas]"
						echo " 7) Netbios Spoofing [$status_netbiosspoofin]"
						echo ""
						echo " 0) exit"
						echo "---------------------------------"

						read Test_opt
						case $Test_opt in

							1)  ###### Start of nmap tool ##########
								while true
									do
										clear
										echo "---------------------------------"
										echo "$yellow $Title v$VERSION$normal - Testing"
										echo "---------------------------------"
										echo -n -e " Current Working Dir: "
										pwd
										echo "---------------------------------"
										echo " 1) Full TCP Scan      [$status_nmap_full_tcp]"
										echo " 2) Quick TCP Scan     [$status_nmap_quick_tcp]"
										echo " 3) Top UDP Scan       [$status_nmap_top_udp]"
										echo " 4) Developer Testing  [$status_nmap_developer]"
										echo ""
										echo " 0) exit"
										echo "---------------------------------"

										read nmap_opt
										case $nmap_opt in

											1)  read -e -p "Enter scope file: " nmap_scope
												echo ""
												read -e -p "Run Full TCP Scan against $nmap_scope, are you sure? [Y/n]" confirm

												if [[ $confirm = n ]];
													then 
														echo "Press Enter to return"
														echo ""
														read enterkey;
													else
														echo ""
														scope="$nmap_scope"
														echo "Running Nmap.."
														echo ""
														nmap -sS -n -v -T4 -O -Pn -A -p- -iL $scope -oA nmap-tcp-full
														echo ""
														echo "Scan Finished.."
														status_nmap_full_tcp=$completed
												fi
												read enterkey;;
											
											2)  read -e -p "Enter scope file: " nmap_scope
												echo ""
												read -e -p "Run Quick TCP Scan against $nmap_scope, are you sure? [Y/n]" confirm

												if [[ $confirm = n ]];
													then 
														echo "Press Enter to return"
														echo ""
														read enterkey;
													else
														echo ""
														scope="$nmap_scope"
														echo "Running Nmap.."
														echo ""
														nmap -sS -n -v -T4 -Pn -O -oA nmap-quick-tcp-scan -iL $scope
														echo ""
														echo "Scan Finished.."
														status_nmap_quick_tcp=$completed
												fi
												read enterkey;;

											3)  read -e -p "Enter scope file: " nmap_scope
												echo ""
												read -e -p "Run Top UDP Scan against $nmap_scope, are you sure? [Y/n]" confirm

												if [[ $confirm = n ]];
													then 
														echo "Press Enter to return"
														echo ""
														read enterkey;
													else
														echo ""
														scope="$nmap_scope"
														echo "Running Nmap.."
														echo ""
														nmap -sU -T4 -v -v -iL $scope -oA nmap-top-udp-scan -Pn --top-ports 1024
														echo ""
														echo "Scan Finished.."
														status_nmap_top_udp=$completed
												fi
												read enterkey;;

											4)  read -e -p "Enter scope file: " nmap_scope
												echo ""
												read -e -p "Run Developer Scan against $nmap_scope, are you sure? [Y/n]" confirm

												if [[ $confirm = n ]];
													then 
														echo "Press Enter to return"
														echo ""
														read enterkey;
													else
														echo ""
														scope="$nmap_scope"
														echo "Running Nmap.."
														echo ""
														nmap -p 80 -iL $scope -oA nmap-developer-scan
														echo ""
														echo "Scan Finished.."
														status_nmap_developer=$completed
												fi
												read enterkey;;

											

											0) 	break
											    ;;

											*)  echo "That is not a valid choice"
											    ;;
										esac
									done
									read enterkey;;
							        ##### End nmap Tool ########

								
							
							2)  ###### Nikto scan #####
								read -e -p "Enter Domain: " nikto_domain
								echo ""
								read -e -p "Run Nikto scan against $nikto_domain, are you sure? [Y/n]" confirm

								if [[ $confirm = n ]];
									then 
										echo "Press Enter to return"
										echo ""
										read enterkey;
									else
										echo ""
										scope="$nikto_domain"
										echo "Running Nikto.."
										echo ""
										nikto -host=$nikto_domain -Format=csv -output=nikto_output.csv -nointeractive
										echo ""
										echo "Scan Finished.."
										status_nikto=$completed
								fi								
								read enterkey;;							
							    ###### End Nikto scan #####

							3)  ###### WPScan #######
								read -e -p "Enter Domain: " wpscan_domain
								echo ""
								read -e -p "Run WPScan against $wpscan_domain, are you sure? [Y/n]" confirm

								if [[ $confirm = n ]];
									then 
										echo "Press Enter to return"
										echo ""
										read enterkey;
									else
										echo ""
										scope="$wpscan_domain"
										echo "Running WPScan.."
										echo ""
										wpscan --url $wpscan_domain --batch --follow-redirection --enumerate u| tee wpscan_output.txt
										echo ""
										echo "Scan Finished.."
										status_wpscan=$completed
								fi				
								read enterkey;;
								###### End WPScan #####


							4)  #### Start Whois scan ######
								read -e -p "Enter scope file: " whois_scope
								echo ""
								read -e -p "Run Whois Scan against $whois_scope, are you sure? [Y/n]" confirm
									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											echo ""
											echo "Running Whois.."
											echo ""
											$whois_parser $whois_scope | tee whois_output.csv
											echo ""
											echo "Scan Finished.."
											echo ""
											echo "Output saved to $(pwd)/whois_output.csv"
											status_whois=$completed
									fi
								read enterkey;;
								#### End OpenVas ############


							5)  ###### Start Nessus scan #######
								read -e -p "Enter scope file: " nessus_scope
								echo ""
								read -e -p "Run Nessus Scan against $nessus_scope, are you sure? [Y/n]" confirm

								if [[ $confirm = n ]];
									then 
										echo "Press Enter to return"
										echo ""
										read enterkey;
									else
										echo ""
										scope="$nessus_scope"
										echo "Running Nessus.."
										echo ""
										#######
										echo ""
										echo "Scan Finished.."
										status_nessus=$completed
								fi
								read enterkey;;
								####### End Nessus#######

							6) #### Start OpenVAS scan ######
								read -e -p "OpenVAS must be configured already within your host operating system. Ar you ready to continue, else it will fail [Y/n]" confirm
								if [[ $confirm = n ]];
									then 
										echo "Press Enter to return"
										echo ""
										read enterkey;
									else
										read -e -p "Enter scope file: " openvas_scope
										echo ""
										read -e -p "Run Openvas Scan against $openvas_scope, are you sure? [Y/n]" confirm
											if [[ $confirm = n ]];
												then 
													echo "Press Enter to return"
													echo ""
													read enterkey;
												else
													echo ""
													scope="$openvas_scope"
													echo "Running Openvas.."
													echo ""
													#######
													echo ""
													echo "Scan Finished.."
													status_openvas=$completed
											fi
								fi
								read enterkey;;
								#### End OpenVas ############				


							0) 	break
							    ;;

							*)  echo "That is not a valid choice"
							    ;;
						esac
					done
					read enterkey;;
			        ##### End Testing Tool ########


			2)  ###### Start Reporting Tool ############

				while true
					do
						clear
						echo "---------------------------------"
						echo "$yellow $Title v$VERSION$normal - Reporting"
						echo "---------------------------------"
						echo -n -e " Current Working Dir: "
						pwd
						echo "---------------------------------"
						echo " 1) Nessus Summary   [$status_reporting_nessus_summary]"
						echo " 2) Nessus breakdown [$status_reporting_nessus_breakdown]"
						echo " 3) Nmap Parser      [$status_reporting_nmap_parser]"
						echo " 4) Nmap Port Count  [$status_reporting_nmap_port_count]"
						echo " 5) Whois Parser     [$status_reporting_whois_parser]"
						echo ""
						echo "------ Work in progress ---------"
						echo ""
						echo " 6) Burp Parser      [$status_reporting_burp_parser]"
						echo " 7) Nikto Parser     [$status_reporting_nikto_parser]"
						echo ""
						echo " 0) exit"
						echo "---------------------------------"

						read Rep_opt
						case $Rep_opt in

							1) 	read -e -p "Enter Nessus File: " nessus
								echo ""
								read -e -p "Parse $nessus, are you sure? [Y/n]" confirm

									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											echo ""
											nessus_file="$nessus"
											echo "Running Nessus Parser.."

											#Run nessus summary
											$nessus_summary $nessus_file
											echo ""
											echo "Parser finished.."
											status_reporting_nessus_summary=$completed
											echo ""
											echo "Output saved:"
											pwd echo -n "newfile.csv"
											echo ""


											# Summmary
											echo "Summary:"
											echo -n -e "$purple Critical: \t"
											echo "$(cat newfile.csv  | cut -d , -f 2 | grep -i critical | wc -l)"
											echo -n -e "$red High:      \t"
											echo "$(cat newfile.csv  | cut -d , -f 2 | grep -i high | wc -l)"
											echo -n -e "$yellow Medium:     \t"
											echo "$(cat newfile.csv  | cut -d , -f 2 | grep -i medium | wc -l)"
											echo -n -e "$green Low:\t\t"
											echo "$(cat newfile.csv  | cut -d , -f 2 | grep -i low | wc -l)"
											echo -n -e "$blue Info: \t\t"
											echo "$(cat newfile.csv  | cut -d , -f 2 | grep -i info | wc -l)$normal"

									fi
								read enterkey;;

							2)  read -e -p "Enter Nessus File: " nessus
								echo ""
								read -e -p "Parse $nessus, are you sure? [Y/n]" confirm
									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											#Run nessus breakdown
											nessus_file="$nessus"
											$nessus_breakdown $nessus_file
											echo ""
											echo "Parser finished.."
											status_reporting_nessus_breakdown=$completed
											echo ""
											echo "Output saved:"
											pwd echo -n "output.txt"
											echo ""

											###Summary
											#need to put a summary here
									fi
								read enterkey;;

							3)  read -e -p "Enter Nmap File: " nmap_file
								echo ""
								read -e -p "Parse $nmap_file, are you sure? [Y/n]" confirm
								echo ""
									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											#Run nmap parser
											echo "Running Nmap Parser.."
											$nmap_parser $nmap_file
											echo ""
											echo "Parser finished.."
											status_reporting_nmap_parser=$completed
											echo ""
											echo -n "Output saved:"
											pwd echo -n "newfile.csv"
											echo ""

											##Summary
											#need to put a summary here
									fi
								read enterkey;;

							4)  read -e -p "Enter Nmap File: " nmap_file
								echo ""
								read -e -p "Parse $nmap_file, are you sure? [Y/n]" confirm
								echo ""
									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											#Run nmap port count
											echo "Running Nmap Port Count.."
											$nmap_portcount $nmap_file
											echo ""
											echo "Parser finished.."
											status_reporting_nmap_port_count=$completed
											echo ""
											echo -n "Output saved: "
											pwd echo -n "data_nmap.csv"
											echo ""
											
											# Summmary
											echo "Summary: Hosts ($yellow$(cat data_nmap.csv | grep -vE 'Filtered' | wc -l)$normal)"
											echo -n -e "$green Open Ports: \t"
											echo "$(cat data_nmap.csv  | cut -d , -f 2 | awk '{s+=$1} END {print s}')"
											echo -n -e "$red Closed Ports: \t"
											echo "$(cat data_nmap.csv  | cut -d , -f 4 | awk '{s+=$1} END {print s}')"
									fi
								read enterkey;;

							5)  read -e -p "Enter Whois scope: " whois_scope
								echo ""
								read -e -p "Parse $whois_scope, are you sure? [Y/n]" confirm
								echo ""
									if [[ $confirm = n ]];
										then 
											echo "Press Enter to return"
											echo ""
											read enterkey;
										else
											#Run nmap port count
											echo "Running Nmap Port Count.."
											$whois_parser $whois_scope
											echo ""
											echo "Parser finished.."
											status_reporting_whois_parser=$completed
											echo ""
											echo -n "Output saved: "
											pwd echo -n "whois_output.csv"
											echo ""
											
											# Summmary
											#need a summary here
									fi
								read enterkey;;

							0) 	break
							    ;;

							*)  echo "That is not a valid choice"
							    ;;
						esac
					done
					read enterkey;;
			        ##### End Reporting Tool ########

			0) 	break
				;;

			*)	echo "That is not a valid choice"
				;;

		esac
	done
