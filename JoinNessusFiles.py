#Dans version 
#Have .nessus files in same directory and double click the script.  

import xml.etree.ElementTree as etree
import shutil
import os

first = 1
for fileName in os.listdir("."):
   if ".nessus" in fileName:
      print(":: Processing...", fileName)
      if first:
         mainTree = etree.parse(fileName)
         report = mainTree.find('Report')
         first = 0
      else:
         tree = etree.parse(fileName)
         for element in tree.findall('.//ReportHost'):
            report.append(element)
      print(":: => Done")
try:
   num1 = raw_input("Report Name/Number: ")

except (RuntimeError, TypeError, NameError):
   num1 = input("Report Name/Number: ")
   

if num1 == "":
   num1 = 0 

   
if ("CombinedReport %s"  % num1) in os.listdir("."):
   try:
      answerReplace = raw_input("Do you want to replace the previous report? Combined Report %s ? " % num1)
   except (RuntimeError, TypeError, NameError):
      answerReplace = input("Do you want to replace the previous report? Combined Report %s ? " % num1)
      
       
   if answerReplace == "y":
     # int(num1)
      shutil.rmtree("CombinedReport %s"  % num1)
      os.mkdir("CombinedReport %s"  % num1)
      mainTree.write("CombinedReport %s/Report.nessus" % num1, encoding="utf-8", xml_declaration=True)
      print("Generated Report: CombinedReport%s/Report.nessus" % str(num1))


   else:
      try:
          int(num1)
          while ("CombinedReport %s" % num1) in os.listdir("."):
             num1 = int(num1) + 1
          os.mkdir("CombinedReport %s"  % str(num1))
          mainTree.write("CombinedReport %s/Report.nessus" % str(num1), encoding="utf-8", xml_declaration=True)
          print("Generated Report: CombinedReport%s/Report.nessus" % str(num1))
         
     
      except ValueError:
         print("File error, please try another name")
         exit
  
else:
   os.mkdir("CombinedReport %s"  % str(num1))
   mainTree.write("CombinedReport %s/Report.nessus" % str(num1), encoding="utf-8", xml_declaration=True)
   print("Generated Report: CombinedReport%s/Report.nessus" % str(num1))

